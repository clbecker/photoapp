<html>
<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

<script src="js/jquery-1.11.2.min.js"></script>
<script src="js/color-thief.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>

</head>
<body>
<style>
#imageContainer {
	display: none;
}
#rothko {
	width: 100%;
	height: 2000px;
	margin-top: -25px;
	overflow: hidden;
}


#rothko > div {
	width: 120%;
	float: left;
	margin-left: -50px;
	margin-right: -50px;
	-webkit-filter: blur(20px);
	-moz-filter: blur(20px);
	-o-filter: blur(20px);
	-ms-filter: blur(20px);
	filter: blur(20px);
}

.cell {
float: left;

}
</style>

<div id="rothko"></div>
<div id="imageContainer"></div>

<script>

function App(args) {
	var self = this;
	this.feed = args.feed;

	var colorThief = new ColorThief();

	this.render = function() {
		this.getImages();
	}

	this.getImages = function() {
		$.ajax({
			method: "GET",
			url: this.feed,
			dataType: "jsonp",
                    	jsonp : "callback",
                    	jsonpCallback: "jsonpcallback",
			success: function(result) {

var maxLikes = 0;
				var images = result.data.map(function(val) {

					var img = val.images.low_resolution;
					img.likes = val.likes.count;
					img.comments = val.comments.count;
					return img;
				});
				self.showImages(images);
			}
		});

	}

	this.showImages = function(images,maxLikes) {
var html = [];

var container = $('#imageContainer');
		for (var i in images) {
			var img = images[i];
			var imgElmt = $('<img src="'+ img.url +'" crossOrigin="Anonymous" height="'+img.height+'" width="'+img.width+'" data-likes="'+img.likes+'">').load(function() {
				$(this).appendTo(container);
				var color = colorThief.getColor(this);
				console.log(color);
				var hex = self.rgbToHex(color);
				var height = ($(this).attr('data-likes') % 200);

				// add some variability to color height
				if (height > 100) {
					height *= 2;
				}

				if (height < 5) {
					height  = 5;
				}
				if (height > 800) {
					height = 800;
				}

				var r = color[0];
				var g = color[1];
				var b = color[2];

				var effects = '-webkit-box-shadow: 10px 10px 20px 20px rgba('+r+','+g+','+b+',0.75); -moz-box-shadow: 10px 10px 20px 20px rgba('+r+','+g+','+b+',0.75); box-shadow: 10px 10px 20px 20px rgba('+r+','+g+','+b+',0.75);'

				var div = $('<div style="background:'+hex+'; height: '+height+'px; '+effects+'"></div>')


				$('#rothko').append(div);
			});
		}
	}

	this.rgbToHex = function (color) {
		var r = color[0];
		var g = color[1];
		var b = color[2];
		return "#" + self.DecToHex(r) + self.DecToHex(g) + self.DecToHex(b);
	}

	this.DecToHex = function(dec) {
    		var hex = dec.toString(16);
   		return hex.length == 1 ? "0" + hex : hex;
	}


return this;
};


var app = new App({
	feed: 'https://api.instagram.com/v1/media/popular?client_id=f3d5267b71cc41c6ba813e68498056f3'
});

app.render();

</script>


</body>
</html>
